<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LME - Learning Portal</title>
    
    <link rel="icon" type="image/png" href="../images/LME-favicon.png">
    <link rel="shortcut icon" type="image/png" href="../images/LME-favicon.png">
    
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    
    <script src="../firebase-config.js"></script>

    <style>
        /* --- Base Styles & Early 2000s Theme --- */
        :root {
            --background-color: #f0f0f0;
            --header-blue: #003366; /* This will be dynamically changed by JS */
            --text-color: #000000;
            --container-bg: #ffffff;
            --border-color: #999999;
            --button-bg: #cccccc;
            --win-gray: #c0c0c0;
            --win-dark-blue: #000080;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            font-family: 'Times New Roman', Times, serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* --- Top Bar --- */
        .top-bar {
            background: var(--header-blue);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #000000;
            flex-shrink: 0;
            color: var(--container-bg);
            position: relative;
        }
        
        .top-bar .nav-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .top-bar .logo {
            font-size: 1.8em;
            font-weight: bold;
        }

        .top-bar .user-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        #user-email {
            font-size: 1em;
            background-color: #004488;
            padding: 5px 10px;
            border: 1px solid #ffffff;
        }

        .action-button {
            text-decoration: none;
            background-color: var(--button-bg);
            color: var(--text-color);
            padding: 5px 15px;
            border: 2px outset #dddddd;
            cursor: pointer;
            font-family: 'Times New Roman', Times, serif;
            font-size: 1em;
        }

        .action-button:active {
            border-style: inset;
        }

        /* --- New Settings Icon & Modal --- */
        #settings-btn {
            background: none;
            border: none;
            padding: 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #settings-btn img {
            width: 24px;
            height: 24px;
        }
        
        #settings-modal-overlay {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.4);
            justify-content: center;
            align-items: center;
            font-family: 'Tahoma', 'Geneva', sans-serif;
            font-size: 12px;
        }

        #settings-window {
            background-color: var(--win-gray);
            border-top: 2px solid white;
            border-left: 2px solid white;
            border-right: 2px solid black;
            border-bottom: 2px solid black;
            padding: 3px;
            width: 380px;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.5);
        }

        #settings-title-bar {
            background-color: var(--win-dark-blue);
            color: white;
            font-weight: bold;
            padding: 3px 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        #settings-close-btn {
            background-color: var(--win-gray);
            border-top: 1px solid white;
            border-left: 1px solid white;
            border-right: 1px solid black;
            border-bottom: 1px solid black;
            color: black;
            font-family: 'Marlett', 'Arial', sans-serif; /* Marlett has the 'r' for close */
            font-size: 14px;
            width: 18px;
            height: 16px;
            line-height: 16px;
            text-align: center;
            cursor: pointer;
        }
        #settings-close-btn:active {
            border-top: 1px solid black;
            border-left: 1px solid black;
            border-right: 1px solid white;
            border-bottom: 1px solid white;
        }
        
        #settings-tabs {
            margin: 0 5px;
        }
        .settings-tab {
            background-color: var(--win-gray);
            padding: 4px 8px;
            border-top: 1px solid white;
            border-left: 1px solid white;
            border-right: 1px solid black;
            position: relative;
            top: 1px; /* To cover the top border of the content pane */
            display: inline-block;
        }

        #settings-content {
            border: 2px solid;
            border-color: #808080 white white #808080;
            padding: 20px;
            margin: 0 5px 5px 5px;
        }
        
        .color-palette {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            justify-items: center;
        }

        .color-swatch {
            width: 40px;
            height: 40px;
            border: 2px outset #dedede;
            cursor: pointer;
        }
        .color-swatch:active {
            border-style: inset;
        }

        #settings-button-bar {
            text-align: right;
            padding: 10px 5px 5px 5px;
        }

        .win-button {
            background-color: var(--win-gray);
            border: 2px outset white;
            padding: 4px 12px;
            min-width: 70px;
            cursor: pointer;
        }
        .win-button:active {
            border-style: inset;
        }

        /* --- Main Content Area --- */
        .main-container {
            flex-grow: 1;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }
        
        .page {
            width: 100%;
            max-width: 750px;
            display: none;
        }
        .page.active { display: block; }
        h1 { font-size: 2em; text-align: center; }
        h2 { font-size: 1.5em; font-weight: normal; text-align: center; }
        
        /* --- Dashboard Page --- */
        #dashboard-page .selection-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 30px;
            margin-top: 40px;
            justify-items: center;
        }

        .subject-button {
            width: 200px;
            height: 120px;
            font-size: 2em;
            font-weight: bold;
            cursor: pointer;
            border: 2px outset #dddddd;
            background-color: var(--button-bg);
            color: var(--text-color);
        }
        .subject-button:hover { background-color: #d8d8d8; }
        .subject-button:active { border-style: inset; }

        /* --- Sub-Menu Pages --- */
        .sub-menu-container {
            background-color: var(--container-bg);
            padding: 20px 40px 30px 40px;
            border: 1px solid var(--border-color);
        }
        .sub-menu-container h3 {
            font-size: 1.6em;
            margin-top: 0;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
            margin-bottom: 25px;
            text-align: center;
        }
        .options-group { margin-bottom: 25px; }
        .options-group legend { font-size: 1.2em; font-weight: bold; margin-bottom: 10px; }
        .options-group label { display: block; margin-bottom: 5px; font-size: 1.1em; }
        .shitty-dropdown {
            font-family: 'Times New Roman', Times, serif;
            font-size: 1em; padding: 5px;
            border: 1px solid var(--border-color);
            background-color: var(--container-bg);
        }
        .start-quiz-btn-container { text-align: center; }
        
        /* --- Quiz Pages --- */
        #quiz-container { background-color: var(--container-bg); padding: 20px; border: 1px solid var(--border-color); }
        #english-paragraph { background-color: #ffffed; border: 1px solid #e3e3d2; padding: 10px; margin-bottom: 20px; font-size: 1.1em; line-height: 1.5; }
        #question-text { font-size: 1.4em; margin-bottom: 25px; text-align: center; font-weight: bold; }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .option-btn { padding: 15px; font-size: 1.1em; background-color: var(--button-bg); border: 2px outset #dddddd; cursor: pointer; text-align: center; font-family: 'Times New Roman', Times, serif; }
        .option-btn:active { border-style: inset; }
        .option-btn.correct-hover:hover { background-color: #C7C7C7; }
        #feedback-area { margin-top: 25px; height: 30px; font-size: 1.2em; font-weight: bold; text-align: center; }
        .feedback-correct { color: #006400; }
        .feedback-incorrect { color: #8B0000; }
        
        /* --- Custom 2000s Popup --- */
        #custom-popup { display: none; position: fixed; bottom: 20px; right: 20px; width: 250px; background-color: #ece9d8; border: 2px outset #ffffff; padding: 2px; font-family: 'Tahoma', 'Geneva', sans-serif; font-size: 12px; z-index: 1000; }
        #custom-popup-header { background-color: #003399; color: white; padding: 3px 5px; font-weight: bold; margin-bottom: 10px; }
        #custom-popup-content { padding: 5px 10px 15px 10px; }
        .hidden { display: none !important; }

    </style>
</head>
<body>

    <header class="top-bar">
        <div class="nav-controls">
            <button id="back-btn" class="action-button hidden">&lt;&lt; Back</button>
            <a href="./dashboard.html" class="action-button">Dashboard</a>
        </div>
        <div class="logo">LME Portal</div>
        <div class="user-controls">
            <span id="user-email">loading...</span>
            <button id="logout-btn" class="action-button">Logout</button>
            <button id="settings-btn" title="Settings"><img src="../images/win98-settings.png" alt="Settings"></button>
        </div>
    </header>

    <main class="main-container">
        <div id="dashboard-page" class="page active">
            <h1>Welcome to the Learning Management Environment</h1>
            <h2>Select a subject to begin.</h2>
            <div class="selection-container">
                <button id="start-math-btn" class="subject-button">Math</button>
                <button id="start-english-btn" class="subject-button">English</button>
                <button id="start-science-btn" class="subject-button">Science</button>
                <button id="start-history-btn" class="subject-button">History</button>
            </div>
        </div>
        <div id="math-menu-page" class="page">
            <div class="sub-menu-container">
                <h3>Math Options</h3>
                <fieldset class="options-group">
                    <legend>Select Operation:</legend>
                    <label><input type="radio" name="math-op" value="+" checked> Addition</label>
                    <label><input type="radio" name="math-op" value="-"> Subtraction</label>
                    <label><input type="radio" name="math-op" value="×"> Multiplication</label>
                    <label><input type="radio" name="math-op" value="÷"> Division</label>
                </fieldset>
                <div class="start-quiz-btn-container">
                    <button id="start-math-quiz-btn" class="action-button" style="padding: 10px 20px; font-size: 1.2em;">Start Math Quiz</button>
                </div>
            </div>
        </div>
        <div id="english-menu-page" class="page">
             <div class="sub-menu-container">
                <h3>English Options</h3>
                <div class="options-group">
                    <label for="english-difficulty" style="font-weight: bold; font-size: 1.2em;">Select Difficulty:</label>
                    <select id="english-difficulty" class="shitty-dropdown">
                        <option value="easy">Easy</option>
                        <option value="medium">Medium</option>
                        <option value="hard">Hard</option>
                    </select>
                </div>
                <div class="start-quiz-btn-container">
                    <button id="start-english-quiz-btn" class="action-button" style="padding: 10px 20px; font-size: 1.2em;">Start English Quiz</button>
                </div>
            </div>
        </div>
        <div id="science-menu-page" class="page">
             <div class="sub-menu-container">
                <h3>Science Options</h3>
                <div class="options-group">
                    <label for="science-category" style="font-weight: bold; font-size: 1.2em;">Select Category:</label>
                    <select id="science-category" class="shitty-dropdown">
                        <option value="elements">Elements</option>
                        <option value="weather">Weather</option>
                        <option value="biology">Biology</option>
                    </select>
                </div>
                <div class="start-quiz-btn-container">
                    <button id="start-science-quiz-btn" class="action-button" style="padding: 10px 20px; font-size: 1.2em;">Start Science Quiz</button>
                </div>
            </div>
        </div>
        <div id="history-menu-page" class="page">
             <div class="sub-menu-container">
                <h3>History Options</h3>
                <div class="options-group">
                    <label for="history-category" style="font-weight: bold; font-size: 1.2em;">Select Category:</label>
                    <select id="history-category" class="shitty-dropdown">
                        <option value="ancient">Ancient History</option>
                        <option value="world">World History</option>
                        <option value="modern">Modern World History</option>
                    </select>
                </div>
                <div class="start-quiz-btn-container">
                    <button id="start-history-quiz-btn" class="action-button" style="padding: 10px 20px; font-size: 1.2em;">Start History Quiz</button>
                </div>
            </div>
        </div>
        <div id="math-quiz-page" class="page"></div>
        <div id="english-quiz-page" class="page"></div>
        <div id="science-quiz-page" class="page"></div>
        <div id="history-quiz-page" class="page"></div>
    </main>
    
    <div id="custom-popup">
        <div id="custom-popup-header">System Notification</div>
        <div id="custom-popup-content">You have been successfully logged out.</div>
    </div>
    
    <div id="settings-modal-overlay">
        <div id="settings-window">
            <div id="settings-title-bar">
                <span>Display Properties</span>
                <div id="settings-close-btn">r</div> </div>
            <div id="settings-tabs">
                <span class="settings-tab">Appearance</span>
            </div>
            <div id="settings-content">
                <div class="color-palette">
                    <div class="color-swatch" data-color="#003366" style="background-color: #003366;"></div>
                    <div class="color-swatch" data-color="#8A2BE2" style="background-color: #8A2BE2;"></div>
                    <div class="color-swatch" data-color="#FF69B4" style="background-color: #FF69B4;"></div>
                    <div class="color-swatch" data-color="#A0522D" style="background-color: #A0522D;"></div>
                    <div class="color-swatch" data-color="#008080" style="background-color: #008080;"></div>
                    <div class="color-swatch" data-color="#32CD32" style="background-color: #32CD32;"></div>
                    <div class="color-swatch" data-color="#FFA500" style="background-color: #FFA500;"></div>
                    <div class="color-swatch" data-color="#4682B4" style="background-color: #4682B4;"></div>
                </div>
            </div>
            <div id="settings-button-bar">
                <button id="settings-ok-btn" class="win-button">OK</button>
            </div>
        </div>
    </div>

    <template id="quiz-template">
        <div id="quiz-container">
            <div id="english-paragraph" style="display: none;"></div>
            <h3 id="question-text"></h3>
            <div class="options-grid">
                <button class="option-btn"></button>
                <button class="option-btn"></button>
                <button class="option-btn"></button>
                <button class="option-btn"></button>
            </div>
            <div id="feedback-area"></div>
        </div>
    </template>


    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // --- DOM Elements ---
        const pages = {
            dashboard: document.getElementById('dashboard-page'),
            mathMenu: document.getElementById('math-menu-page'),
            englishMenu: document.getElementById('english-menu-page'),
            scienceMenu: document.getElementById('science-menu-page'),
            historyMenu: document.getElementById('history-menu-page'),
            mathQuiz: document.getElementById('math-quiz-page'),
            englishQuiz: document.getElementById('english-quiz-page'),
            scienceQuiz: document.getElementById('science-quiz-page'),
            historyQuiz: document.getElementById('history-quiz-page')
        };
        const userEmailEl = document.getElementById('user-email');
        const logoutBtn = document.getElementById('logout-btn');
        const customPopup = document.getElementById('custom-popup');
        const backBtn = document.getElementById('back-btn');
        
        // Subject buttons
        const startMathBtn = document.getElementById('start-math-btn');
        const startEnglishBtn = document.getElementById('start-english-btn');
        const startScienceBtn = document.getElementById('start-science-btn');
        const startHistoryBtn = document.getElementById('start-history-btn');

        // Quiz start buttons
        const startMathQuizBtn = document.getElementById('start-math-quiz-btn');
        const startEnglishQuizBtn = document.getElementById('start-english-quiz-btn');
        const startScienceQuizBtn = document.getElementById('start-science-quiz-btn');
        const startHistoryQuizBtn = document.getElementById('start-history-quiz-btn');
        
        // Settings elements
        const settingsBtn = document.getElementById('settings-btn');
        const settingsModalOverlay = document.getElementById('settings-modal-overlay');
        const settingsCloseBtn = document.getElementById('settings-close-btn');
        const settingsOkBtn = document.getElementById('settings-ok-btn');
        const colorSwatches = document.querySelectorAll('.color-swatch');

        const quizTemplate = document.getElementById('quiz-template');

        // --- State Management ---
        let currentSubject = null;
        let mathOperation = '+';
        let englishDifficulty = 'easy';
        let scienceCategory = 'elements';
        let historyCategory = 'ancient';
        let questionCounter = 0;
        let forceWrongAfter = Math.floor(Math.random() * 7) + 4;

        // --- Firebase Authentication ---
        if (typeof firebase !== 'undefined' && firebase.app) {
            firebase.auth().onAuthStateChanged(user => {
                if (user) {
                    userEmailEl.textContent = user.email;
                } else {
                    window.location.href = '../login.html';
                }
            });

            logoutBtn.addEventListener('click', () => {
                firebase.auth().signOut().then(() => {
                    customPopup.style.display = 'block';
                    setTimeout(() => {
                        customPopup.style.display = 'none';
                        window.location.href = '../index.html';
                    }, 2500);
                }).catch(error => { console.error("Logout Error:", error); });
            });
        } else {
            console.error("Firebase is not initialized.");
            userEmailEl.textContent = 'config_error';
        }

        // --- Settings Logic ---
        const applySavedTheme = () => {
            const savedColor = localStorage.getItem('topBarColor');
            if (savedColor) {
                document.documentElement.style.setProperty('--header-blue', savedColor);
            }
        };
        
        const openSettings = () => settingsModalOverlay.style.display = 'flex';
        const closeSettings = () => settingsModalOverlay.style.display = 'none';

        settingsBtn.addEventListener('click', openSettings);
        settingsCloseBtn.addEventListener('click', closeSettings);
        settingsOkBtn.addEventListener('click', closeSettings);
        settingsModalOverlay.addEventListener('click', (e) => {
            if (e.target === settingsModalOverlay) {
                closeSettings();
            }
        });

        colorSwatches.forEach(swatch => {
            swatch.addEventListener('click', () => {
                const color = swatch.dataset.color;
                document.documentElement.style.setProperty('--header-blue', color);
                localStorage.setItem('topBarColor', color);
            });
        });
        
        applySavedTheme();

        // --- Page Navigation Logic ---
        const showPage = (pageName) => {
            Object.values(pages).forEach(page => page.classList.remove('active'));
            if (pages[pageName]) {
                pages[pageName].classList.add('active');
            }
            const isMenuOrQuiz = ['mathMenu', 'englishMenu', 'scienceMenu', 'historyMenu', 'mathQuiz', 'englishQuiz', 'scienceQuiz', 'historyQuiz'].includes(pageName);
            backBtn.classList.toggle('hidden', !isMenuOrQuiz);
        };
        backBtn.addEventListener('click', () => {
             const activeQuizPage = document.querySelector('.page.active[id*="quiz"]');
             if(activeQuizPage) {
                if(currentSubject === 'math') showPage('mathMenu');
                else if(currentSubject === 'english') showPage('englishMenu');
                else if(currentSubject === 'science') showPage('scienceMenu');
                else if(currentSubject === 'history') showPage('historyMenu');
             } else {
                showPage('dashboard');
             }
        });
        startMathBtn.addEventListener('click', () => showPage('mathMenu'));
        startEnglishBtn.addEventListener('click', () => showPage('englishMenu'));
        startScienceBtn.addEventListener('click', () => showPage('scienceMenu'));
        startHistoryBtn.addEventListener('click', () => showPage('historyMenu'));
        startMathQuizBtn.addEventListener('click', () => {
            mathOperation = document.querySelector('input[name="math-op"]:checked').value;
            currentSubject = 'math';
            showPage('mathQuiz');
            generateNewQuestion();
        });
        startEnglishQuizBtn.addEventListener('click', () => {
            englishDifficulty = document.getElementById('english-difficulty').value;
            currentSubject = 'english';
            showPage('englishQuiz');
            generateNewQuestion();
        });
        startScienceQuizBtn.addEventListener('click', () => {
            scienceCategory = document.getElementById('science-category').value;
            currentSubject = 'science';
            showPage('scienceQuiz');
            generateNewQuestion();
        });
        startHistoryQuizBtn.addEventListener('click', () => {
            historyCategory = document.getElementById('history-category').value;
            currentSubject = 'history';
            showPage('historyQuiz');
            generateNewQuestion();
        });


        // --- Question Databases ---
        const englishData = [ { paragraph: "The ubiquitous nature of smartphones has engendered a paradigm shift in social interactions. Previously quotidian activities, like conversing in person, are often superseded by digital communication, leading some sociologists to prognosticate a future characterized by attenuated interpersonal skills.", questions: [ { q: "What does the word 'ubiquitous' mean?", a: "Present everywhere", i: ["Rare and unusual", "Technologically advanced", "Very expensive"] }, { q: "What does 'attenuated' mean in this context?", a: "Weakened or reduced", i: ["Strengthened", "Complicated", "Digitized"] }, { q: "What future development does the author 'prognosticate'?", a: "A decline in social skills", i: ["An increase in phone sales", "A new type of technology", "Stronger family bonds"] } ] }, { paragraph: "The politician's speech was a masterclass in equivocation. He managed to address the contentious issue for ten minutes without adopting a definitive stance, leaving both his supporters and detractors to parse his ambiguous statements for a semblance of commitment.", questions: [ { q: "What does 'equivocation' mean?", a: "Using ambiguous language to conceal the truth", i: ["Speaking with great passion", "Telling a compelling story", "Making a firm promise"] }, { q: "What was the primary characteristic of the politician's statements?", a: "They were ambiguous", i: ["They were factual", "They were short", "They were dishonest"] }, { q: "What is a 'semblance' of commitment?", a: "An appearance or trace", i: ["A written guarantee", "A loud declaration", "A total lack"] } ] }, { paragraph: "Despite his ostensibly convivial demeanor, the CEO was a martinet in the boardroom. He demanded punctiliousness from his subordinates and would excoriate anyone who failed to meet his exacting standards, believing that such rigor was essential for corporate hegemony.", questions: [ { q: "What does the word 'convivial' suggest?", a: "Friendly and sociable", i: ["Strict and severe", "Sad and lonely", "Business-focused"] }, { q: "A 'martinet' is a...", a: "Strict disciplinarian", i: ["Cheerful person", "Successful leader", "Financial expert"] }, { q: "To 'excoriate' someone is to...", a: "Criticize them severely", i: ["Praise them highly", "Give them a promotion", "Ignore them completely"] } ] }, { paragraph: "The nascent environmental movement gained significant traction after incontrovertible evidence of climate change was published. The data, once considered esoteric, became a clarion call for legislative action, despite vociferous opposition from entrenched industrial interests.", questions: [ { q: "A 'nascent' movement is one that is...", a: "Just beginning to develop", i: ["Globally recognized", "Losing support", "Politically powerful"] }, { q: "'Incontrovertible' evidence is...", a: "Undeniable", i: ["Confusing", "Secretive", "Limited"] }, { q: "What does 'vociferous' mean?", a: "Loud and forceful", i: ["Quiet and thoughtful", "Secretly planned", "Based on logic"] } ] }, { paragraph: "Her predilection for rococo art was evident in her home's decor. Every room was replete with ornate furniture, intricate tapestries, and gilded mirrors, creating an atmosphere that some found opulent but others considered ostentatious.", questions: [ { q: "What is a 'predilection'?", a: "A preference or special liking", i: ["A dislike or hatred", "A casual interest", "A professional knowledge"] }, { q: "If a room is 'replete' with something, it is...", a: "Filled or well-supplied", i: ["Lacking in", "Famous for", "Painted with"] }, { q: "What does 'ostentatious' mean?", a: "Designed to impress or attract notice, often vulgarly", i: ["Comfortable and cozy", "Historically accurate", "Minimalist and simple"] } ] }, { paragraph: "The philosopher's work was intentionally recondite, written for a small cadre of academics. He eschewed simple language, preferring abstruse terminology that he felt more accurately captured the nuances of his metaphysical theories.", questions: [ { q: "What does 'recondite' mean?", a: "Little known; obscure", i: ["Widely popular", "Easy to read", "Visually illustrated"] }, { q: "To 'eschew' something is to...", a: "Deliberately avoid using it", i: ["Use it frequently", "Explain it simply", "Invent it"] }, { q: "An 'abstruse' terminology is...", a: "Difficult to understand", i: ["Common and everyday", "Foreign and exotic", "Technical and precise"] } ] }, { paragraph: "The general's pyrrhic victory was celebrated in the capital, but on the battlefield, the mood was somber. The catastrophic loss of life had vitiated any sense of triumph, leaving the soldiers to ponder the true cost of their success.", questions: [ { q: "A 'pyrrhic' victory is one that...", a: "Comes at too great a cost", i: ["Is achieved easily", "Is a complete surprise", "Leads to total peace"] }, { q: "To 'vitiate' a sense of triumph means to...", a: "Spoil or impair its quality", i: ["Enhance or increase it", "Announce it publicly", "Celebrate it"] }, { q: "The mood on the battlefield was 'somber', which means...", a: "Gloomy and serious", i: ["Joyful and celebratory", "Tense and nervous", "Calm and peaceful"] } ] }, { paragraph: "The mendacious salesman was a paragon of duplicity. He could sell superfluous gadgets to even the most parsimonious customers, using a combination of flattery and outright falsehoods to close a deal.", questions: [ { q: "A 'mendacious' person is...", a: "Not telling the truth; lying", i: ["Highly successful", "Very persuasive", "Generous and kind"] }, { q: "What does 'superfluous' mean?", a: "Unnecessary", i: ["Expensive", "Technologically advanced", "Essential"] }, { q: "A 'parsimonious' customer is...", a: "Very unwilling to spend money", i: ["Easy to fool", "Wealthy and influential", "Looking for luxury goods"] } ] }, { paragraph: "His laconic responses during the interview were a source of frustration for the reporter. He would answer complex questions with a single, often sardonic, word, refusing to elaborate on his motivations or future plans.", questions: [ { q: "A 'laconic' response is...", a: "Using very few words", i: ["Long and detailed", "Angry and emotional", "Confusing and vague"] }, { q: "What does 'sardonic' mean?", a: "Grimly mocking or cynical", i: ["Cheerful and optimistic", "Honest and direct", "Polite and respectful"] }, { q: "To 'elaborate' is to...", a: "Provide more detail", i: ["Change the subject", "Tell a lie", "Ask a question"] } ] }, { paragraph: "The artist's oeuvre was eclectic, spanning from minimalist sculptures to sprawling, chaotic canvases. This refusal to adhere to a single style was initially seen as a weakness but was later lauded as a sign of his prodigious versatility.", questions: [ { q: "An 'eclectic' collection is one that is...", a: "Made up of a variety of styles or ideas", i: ["Focused on a single theme", "Arranged in chronological order", "Worth a lot of money"] }, { q: "An artist's 'oeuvre' refers to...", a: "Their entire body of work", i: ["Their most famous painting", "Their art studio", "Their early life"] }, { q: "What does 'prodigious' mean?", a: "Impressively great in extent, size, or degree", i: ["Lacking in skill", "Slowly developing", "Causing controversy"] } ] } ];
        const scienceData = { elements: [ { q: "What is the chemical symbol for Gold?", a: "Au", i: ["Ag", "Go", "Gd"] }, { q: "Which element is essential for respiration?", a: "Oxygen", i: ["Nitrogen", "Carbon", "Hydrogen"] }, { q: "What is the most abundant element in the Earth's crust?", a: "Oxygen", i: ["Silicon", "Aluminum", "Iron"] }, ], weather: [ { q: "What instrument measures atmospheric pressure?", a: "Barometer", i: ["Thermometer", "Hygrometer", "Anemometer"] }, { q: "Which type of cloud is associated with thunderstorms?", a: "Cumulonimbus", i: ["Cirrus", "Stratus", "Altocumulus"] }, { q: "What is the name for a rotating column of air in contact with both the surface of the Earth and a cloud?", a: "Tornado", i: ["Hurricane", "Cyclone", "Typhoon"] }, ], biology: [ { q: "What is the powerhouse of the cell?", a: "Mitochondria", i: ["Nucleus", "Ribosome", "Cytoplasm"] }, { q: "What process do plants use to convert light into energy?", a: "Photosynthesis", i: ["Respiration", "Transpiration", "Germination"] }, { q: "How many chambers are in the human heart?", a: "Four", i: ["Two", "Three", "Five"] }, ] };
        const historyData = { ancient: [ { q: "Who was the first emperor of Rome?", a: "Augustus", i: ["Julius Caesar", "Nero", "Constantine"] }, { q: "The Great Pyramid of Giza was built for which pharaoh?", a: "Khufu", i: ["Tutankhamun", "Ramesses II", "Akhenaten"] }, { q: "In which city-state did democracy first develop?", a: "Athens", i: ["Sparta", "Corinth", "Thebes"] }, ], world: [ { q: "The Magna Carta was signed in what year?", a: "1215", i: ["1066", "1492", "1776"] }, { q: "Who is credited with starting the Protestant Reformation?", a: "Martin Luther", i: ["John Calvin", "Henry VIII", "Jan Hus"] }, { q: "The Silk Road connected Europe with which continent?", a: "Asia", i: ["Africa", "Australia", "North America"] }, ], modern: [ { q: "World War I began in which year?", a: "1914", i: ["1918", "1939", "1941"] }, { q: "The first man to walk on the moon was Neil who?", a: "Armstrong", i: ["Aldrin", "Gagarin", "Shepard"] }, { q: "The fall of the Berlin Wall in 1989 symbolized the end of what?", a: "The Cold War", i: ["World War II", "The Vietnam War", "The Space Race"] }, ] };

        // --- Core Quiz Logic ---
        const generateNewQuestion = () => {
            let questionData;
            switch (currentSubject) {
                case 'math':    questionData = generateMathProblem(); break;
                case 'english': questionData = generateEnglishProblem(); break;
                case 'science': questionData = generateScienceProblem(); break;
                case 'history': questionData = generateHistoryProblem(); break;
                default: console.error("Unknown subject:", currentSubject); return;
            }
            renderQuestion(questionData);
        };
        const generateMathProblem = () => { const op = mathOperation; let n1, n2, answer; if (op === '+') { n1 = Math.floor(Math.random() * 50) + 1; n2 = Math.floor(Math.random() * 50) + 1; answer = n1 + n2; } else if (op === '-') { n1 = Math.floor(Math.random() * 50) + 20; n2 = Math.floor(Math.random() * (n1 - 1)) + 1; answer = n1 - n2; } else if (op === '×') { n1 = Math.floor(Math.random() * 12) + 1; n2 = Math.floor(Math.random() * 12) + 1; answer = n1 * n2; } else { n2 = Math.floor(Math.random() * 12) + 2; answer = Math.floor(Math.random() * 12) + 2; n1 = n2 * answer; } const questionText = `What is ${n1} ${op} ${n2}?`; const options = generateDistractors(answer); return { question: questionText, options: options, correctAnswer: answer }; };
        const generateEnglishProblem = () => { const paragraphData = englishData[Math.floor(Math.random() * englishData.length)]; const questionData = paragraphData.questions[Math.floor(Math.random() * paragraphData.questions.length)]; const questionText = questionData.q; const correctAnswer = questionData.a; const options = [correctAnswer, ...questionData.i].sort(() => Math.random() - 0.5); return { paragraph: paragraphData.paragraph, question: questionText, options: options, correctAnswer: correctAnswer }; };
        const generateScienceProblem = () => { const questionSet = scienceData[scienceCategory]; const data = questionSet[Math.floor(Math.random() * questionSet.length)]; const options = [data.a, ...data.i].sort(() => Math.random() - 0.5); return { question: data.q, options: options, correctAnswer: data.a }; };
        const generateHistoryProblem = () => { const questionSet = historyData[historyCategory]; const data = questionSet[Math.floor(Math.random() * questionSet.length)]; const options = [data.a, ...data.i].sort(() => Math.random() - 0.5); return { question: data.q, options: options, correctAnswer: data.a }; };
        const generateDistractors = (correctAnswer) => { const distractors = new Set(); while (distractors.size < 3) { const offset = Math.floor(Math.random() * 10) + 1; const sign = Math.random() < 0.5 ? 1 : -1; let distractor = correctAnswer + (offset * sign); if (distractor !== correctAnswer && distractor >= 0) { distractors.add(distractor); } } const options = [correctAnswer, ...distractors]; return options.sort(() => Math.random() - 0.5); };
        const renderQuestion = (data) => {
            let pageKey;
            switch (currentSubject) {
                case 'math':    pageKey = 'mathQuiz'; break;
                case 'english': pageKey = 'englishQuiz'; break;
                case 'science': pageKey = 'scienceQuiz'; break;
                case 'history': pageKey = 'historyQuiz'; break;
            }
            const targetContainer = pages[pageKey];
            targetContainer.innerHTML = '';
            const clone = quizTemplate.content.cloneNode(true);
            targetContainer.appendChild(clone);
            const questionTextEl = targetContainer.querySelector('#question-text');
            const optionBtns = targetContainer.querySelectorAll('.option-btn');
            const feedbackAreaEl = targetContainer.querySelector('#feedback-area');
            const paragraphEl = targetContainer.querySelector('#english-paragraph');
            feedbackAreaEl.textContent = '';
            questionTextEl.textContent = data.question;
            if (data.paragraph) { paragraphEl.textContent = data.paragraph; paragraphEl.style.display = 'block'; }
            optionBtns.forEach((btn, index) => {
                const optionValue = data.options[index];
                btn.textContent = optionValue;
                btn.classList.remove('correct-hover');
                if (String(optionValue) === String(data.correctAnswer)) {
                    btn.classList.add('correct-hover');
                }
                btn.addEventListener('click', handleAnswerClick);
            });
        };
        const handleAnswerClick = (event) => {
            const selectedBtn = event.target;
            const quizContainer = selectedBtn.closest('#quiz-container');
            const feedbackAreaEl = quizContainer.querySelector('#feedback-area');
            questionCounter++;
            let isCorrect = selectedBtn.classList.contains('correct-hover');
            if (questionCounter >= forceWrongAfter) {
                isCorrect = false;
                questionCounter = 0;
                forceWrongAfter = Math.floor(Math.random() * 7) + 4;
                console.log(`Forcing incorrect. Next forced wrong in ${forceWrongAfter} questions.`);
            }
            if (isCorrect) {
                feedbackAreaEl.textContent = 'Correct!';
                feedbackAreaEl.className = 'feedback-correct';
            } else {
                feedbackAreaEl.textContent = 'Incorrect. Please try the next one.';
                feedbackAreaEl.className = 'feedback-incorrect';
            }
            quizContainer.querySelectorAll('.option-btn').forEach(btn => {
                btn.removeEventListener('click', handleAnswerClick);
                btn.style.cursor = 'default';
            });
            setTimeout(() => { generateNewQuestion(); }, 2000);
        };
    });
    </script>
</body>
</html>
