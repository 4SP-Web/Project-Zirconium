<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Constel Dashboard (by Vern)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./style.css"> </head>

<body class="constel-page constel-dashboard-layout">

  <header class="main-header constel-header">
    <div class="container">
      <div class="logo">
        <a href="./index.html"> <img src="../../images/logo.png" alt="Constel by Vern Logo" />
        </a>
      </div>
      <div class="auth-buttons">
        <button class="btn btn-link" onclick="window.location.href='../../index.html'">V4 Home</button>
        <button id="logoutBtnConstel" class="btn btn-primary">LOG OUT</button>
      </div>
    </div>
  </header>

  <div class="constel-app-container">
    <aside class="constel-sidebar">
      <nav>
        <ul>
          <li><a href="#dashboard" class="active-link" data-section="dashboard"><span class="icon">📊</span><span class="label">Dashboard</span></a></li>
          <li><a href="#following" data-section="following"><span class="icon">👀</span><span class="label">Following</span></a></li>
          <li><a href="#followers" data-section="followers"><span class="icon">👥</span><span class="label">Followers</span></a></li>
          <li><a href="#friends" data-section="friends"><span class="icon">🫂</span><span class="label">Friends</span></a></li>
          <li><a href="#chats" data-section="chats"><span class="icon">💬</span><span class="label">Chats</span></a></li>
          <li><a href="#groupchats" data-section="groupchats"><span class="icon">🗣️</span><span class="label">Group Chats</span></a></li>
          <li><a href="#settings" data-section="settings"><span class="icon">⚙️</span><span class="label">Settings</span></a></li>
        </ul>
      </nav>
      <div class="sidebar-user-info">
        <span id="sidebarUsername" class="username-display">User</span>
        </div>
    </aside>

    <main class="constel-dashboard-main">
      <section id="dashboard-content" class="content-section active-section">
        <h1>Dashboard</h1>
        <p>Welcome to your Constel dashboard! This is where your main overview will be.</p>
        <div class="placeholder-content">
          <p>(Dashboard widgets and summary will appear here)</p>
        </div>
      </section>

      <section id="following-content" class="content-section">
        <h1>Following</h1>
        <p>See updates from users you follow.</p>
        <div class="placeholder-content"><p>(Following feed/list)</p></div>
      </section>

      <section id="followers-content" class="content-section">
        <h1>Followers</h1>
        <p>Users who are following you.</p>
        <div class="placeholder-content"><p>(Followers list)</p></div>
      </section>

      <section id="friends-content" class="content-section">
        <h1>Friends</h1>
        <p>Your mutual connections.</p>
        <div class="placeholder-content"><p>(Friends list)</p></div>
      </section>

      <section id="chats-content" class="content-section">
        <h1>Chats</h1>
        <p>Your private conversations.</p>
         <div class="placeholder-content"><p>(Chat interface/list)</p></div>
      </section>

      <section id="groupchats-content" class="content-section">
        <h1>Group Chats</h1>
        <p>Conversations with multiple people.</p>
        <div class="placeholder-content"><p>(Group chat interface/list)</p></div>
      </section>

      <section id="settings-content" class="content-section">
        <h1>Settings</h1>
        <p>Manage your Constel account settings.</p>
        <div class="placeholder-content"><p>(Settings options)</p></div>
      </section>
      <div id="statusMessages"></div>
    </main>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
  <script src="../../firebase-config.js"></script>
  <script>
    const statusMessagesEl = document.getElementById('statusMessages');
    const sidebarUsernameEl = document.getElementById('sidebarUsername');


    function showStatusMessage(message, type = 'info', duration = 4000) {
        if (!statusMessagesEl) return;
        statusMessagesEl.textContent = message;
        statusMessagesEl.className = '';
        statusMessagesEl.classList.add(`status-${type}`);
        statusMessagesEl.style.display = 'block';
        if (duration > 0) {
            setTimeout(() => { statusMessagesEl.style.display = 'none'; }, duration);
        }
    }

    const logoutBtnConstel = document.getElementById('logoutBtnConstel');
    if (logoutBtnConstel) {
      logoutBtnConstel.addEventListener('click', () => {
        if (typeof firebase !== 'undefined' && firebase.auth) {
          firebase.auth().signOut().then(() => {
            console.log('User signed out');
            window.location.href = '../../login.html';
          }).catch(error => {
            console.error('Sign out error', error);
            showStatusMessage('Error signing out: ' + error.message, 'error');
          });
        } else {
          console.error('Firebase auth is not available.');
          showStatusMessage('Logout service unavailable.', 'error');
        }
      });
    }
    
    let currentUser = null; // To store the current user object

    firebase.auth().onAuthStateChanged(user => {
      currentUser = user;
      if (user) {
        console.log("User is signed into Constel dashboard:", user.email);
        if(sidebarUsernameEl) sidebarUsernameEl.textContent = user.displayName || user.email.split('@')[0];
        
        // Fetch more detailed username from Firestore if available
        const userProfileRef = firebase.firestore().collection('users').doc(user.uid);
        userProfileRef.get().then(docSnap => {
            if (docSnap.exists) {
                const userData = docSnap.data();
                if (sidebarUsernameEl && userData.username) {
                    sidebarUsernameEl.textContent = userData.username;
                }
            }
        }).catch(error => {
            console.error("Error fetching user profile for sidebar:", error);
        });

      } else {
        console.log("User is signed out from Constel dashboard.");
        if(sidebarUsernameEl) sidebarUsernameEl.textContent = "Guest";
        // Redirect to login if not logged in, as this is a dashboard
        window.location.href = '../../login.html';
      }
    });

    // Sidebar navigation logic
    const sidebarLinks = document.querySelectorAll('.constel-sidebar nav a');
    const contentSections = document.querySelectorAll('.content-section');

    sidebarLinks.forEach(link => {
        link.addEventListener('click', (event) => {
            event.preventDefault();
            
            sidebarLinks.forEach(l => l.classList.remove('active-link'));
            link.classList.add('active-link');
            
            const sectionId = link.dataset.section + '-content';
            contentSections.forEach(section => {
                if (section.id === sectionId) {
                    section.classList.add('active-section');
                } else {
                    section.classList.remove('active-section');
                }
            });
            // Update main content header (optional)
            const mainContentHeader = document.querySelector('.constel-dashboard-main h1');
            if(mainContentHeader) {
                mainContentHeader.textContent = link.querySelector('.label').textContent;
            }
        });
    });

  </script>
</body>
</html>
