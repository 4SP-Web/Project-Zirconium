<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Grade Checker - HAC API</title>
    <link rel="stylesheet" href="../css/style.css">
    
    <style>
        :root {
            --v4-bg-gradient: linear-gradient(135deg, #f0f2f5 0%, #e8eaf0 100%);
            --v4-card-bg: #fff;
            --v4-text-primary: #333;
            --v4-text-secondary: #555;
            --v4-purple-accent: #6720bd;
            --v4-purple-accent-darker: #5a1aa8;
            --v4-purple-gradient: linear-gradient(135deg, #6720bd 0%, #8a2be2 100%);
            --v4-border-light: #ddd;
            --v4-border-softer: #eee;
            --v4-input-bg: #f8f9fa;
            --v4-input-border: #ccc;
            --v4-font-primary: 'PrimaryFont', sans-serif;
            --v4-font-secondary: 'SecondaryFont', sans-serif;
        }
        .hidden { display: none !important; }
        body { display: flex; flex-direction: column; min-height: 100vh; margin: 0; font-family: var(--v4-font-primary); background: var(--v4-bg-gradient); color: var(--v4-text-primary); line-height: 1.6; }
        .container-wrapper { display: flex; flex: 1; overflow: hidden; }
        
        /* Sidebar */
        .sidebar { width: 200px; background: linear-gradient(180deg, #333 0%, #2a2a2a 100%); color: #fff; padding: 20px 10px; display: flex; flex-direction: column; border-right: 1px solid #444; transition: width 0.5s ease-in-out; position: relative; box-shadow: 2px 0 10px rgba(0,0,0,0.1); }
        .sidebar nav ul { list-style: none; padding: 0; margin: 60px 0 0; }
        .sidebar nav li { margin-bottom: 10px; }
        .sidebar nav a { display: flex; align-items: center; padding: 12px 15px; color: #fff; text-decoration: none; border-radius: 8px; transition: all 0.3s ease; font-family: 'PrimaryFont', sans-serif; text-transform: uppercase; }
        .sidebar nav a.active, .sidebar nav a:hover { background: var(--v4-purple-gradient); transform: translateX(5px); }
        .sidebar nav a .icon { font-size: 1.2em; width: 24px; text-align: center; }
        .sidebar nav a .label { margin-left: 10px; white-space: nowrap; }

        .main-content { flex: 1; padding: 30px; background: var(--v4-bg-gradient); overflow-y: auto; display: flex; flex-direction: column; }
        .page-header-v4 { margin-bottom: 25px; background: var(--v4-card-bg); padding: 20px 30px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); display: flex; justify-content: space-between; align-items: center; }
        .page-title-v4 { font-size: 2.2em; font-weight: bold; background: var(--v4-purple-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .status-message-v4 { display: none; padding: 15px 25px; margin: 0 auto 20px auto; border-radius: 12px; text-align: center; max-width: 600px; text-transform: uppercase; box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1); color: white; }
        .status-message-v4.success { background: linear-gradient(135deg, #1c7430, #155724); }
        .status-message-v4.error { background: linear-gradient(135deg, #8f262a, #721c24); }
        .status-message-v4.info { background: linear-gradient(135deg, #004085, #002752); }
        
        /* Login Form Styling */
        #login-container { background: var(--v4-card-bg); padding: 35px; border-radius: 15px; box-shadow: 0 6px 30px rgba(0,0,0,0.08); margin: auto; max-width: 500px; width: 100%; }
        #loginForm .form-group { margin-bottom: 20px; }
        #loginForm label { font-weight: bold; color: var(--v4-text-secondary); margin-bottom: 8px; display: block; }
        #loginForm input { width: 100%; padding: 14px; border: 1px solid var(--v4-input-border); border-radius: 8px; background: var(--v4-input-bg); font-family: var(--v4-font-secondary); font-size: 1.1em; box-sizing: border-box; transition: all 0.3s ease; }
        #loginForm input:focus { box-shadow: 0 0 0 3px rgba(103, 32, 189, 0.3); border-color: var(--v4-purple-accent); }
        #loginForm button { width: 100%; }

        #gradesView { overflow-y: auto; padding: 5px; margin-top: 25px; display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }

        .btn { border: none; padding: 14px 24px; border-radius: 10px; font-family: var(--v4-font-primary); text-transform: uppercase; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .btn-primary { background: var(--v4-purple-gradient); color: white; }
        .btn-primary:hover { transform: translateY(-3px); box-shadow: 0 6px 20px rgba(103, 32, 189, 0.4); }
        .btn-primary:disabled { background: #ccc; cursor: not-allowed; transform: none; box-shadow: none; }
        .btn-logout { background: linear-gradient(135deg, #8f262a, #721c24); color: white; }
        .btn-logout:hover { transform: translateY(-3px); box-shadow: 0 6px 20px rgba(143, 38, 42, 0.4); }
        
        .class-card { background: var(--v4-card-bg); border: 2px solid transparent; border-radius: 15px; margin-bottom: 20px; padding: 20px 25px; box-shadow: 0 6px 30px rgba(0,0,0,0.08); transition: all 0.2s ease-in-out; position: relative; cursor: pointer; }
        .class-card:hover { transform: translateY(-5px); box-shadow: 0 8px 35px rgba(0,0,0,0.12); border-color: var(--v4-purple-accent); }
        
        .class-card-header { display: flex; justify-content: space-between; align-items: flex-start; gap: 15px; }
        .class-info { flex-grow: 1; min-width: 0; }
        .class-title { font-size: 1.6em; font-weight: bold; color: var(--v4-text-primary); }
        .class-teacher { font-size: 1em; color: var(--v4-text-secondary); font-family: var(--v4-font-secondary); }
        .class-grade-display { font-size: 2.5em; font-weight: bold; color: var(--v4-purple-accent); }
        
        /* Modal Styling */
        .modal-backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); z-index: 2000; opacity: 0; transition: opacity 0.3s ease; pointer-events: none; display: flex; align-items: center; justify-content: center; }
        .modal-backdrop.visible { opacity: 1; pointer-events: auto; }
        .modal-content { background: var(--v4-card-bg); width: 90%; max-width: 800px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); display: flex; flex-direction: column; max-height: 90vh; transform: scale(0.95); transition: transform 0.3s ease; }
        .modal-backdrop.visible .modal-content { transform: scale(1); }
        .modal-header { padding: 20px 25px; border-bottom: 1px solid var(--v4-border-softer); position: relative; }
        .modal-header h2 { margin: 0; font-size: 1.5em; color: var(--v4-text-primary); }
        .modal-body { flex-grow: 1; overflow-y: auto; padding: 25px; }
        .modal-footer { padding: 15px 25px; border-top: 1px solid var(--v4-border-softer); display: flex; justify-content: flex-end; align-items: center; gap: 10px; }
        .close-btn { position: absolute; top: 15px; right: 15px; background: none; border: none; cursor: pointer; padding: 5px; line-height: 0; }
        .close-btn img { width: 20px; height: 20px; filter: invert(80%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(100%) contrast(100%); transition: filter 0.3s ease; }
        .close-btn:hover img { filter: invert(10%) sepia(10%) saturate(0%) hue-rotate(240deg) brightness(100%) contrast(100%); }

        /* Assignment List Styling */
        .assignments-container { display: flex; flex-direction: column; gap: 15px; }
        .assignment-category { margin-bottom: 10px; }
        .assignment-category-title { font-size: 1.2em; font-weight: bold; color: var(--v4-purple-accent); padding-bottom: 5px; border-bottom: 2px solid var(--v4-purple-accent); margin-bottom: 10px; }
        .assignment-row { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-radius: 8px; background-color: var(--v4-input-bg); border: 1px solid var(--v4-border-softer); }
        .assignment-name { font-size: 1em; color: var(--v4-text-primary); }
        .assignment-score { font-size: 1.1em; font-weight: bold; color: var(--v4-text-secondary); }
    </style>
</head>
<body class="page">

    <header class="main-header light-bg">
        <div class="container">
            <div class="logo"><a href="#"><img src="../images/logo-dark.png" alt="Logo"/></a></div>
        </div>
    </header>

    <div class="container-wrapper">
        <aside class="sidebar slide-in" id="sidebar">
            <nav>
                <ul>
                    <li><a href="#"><span class="icon">üè†</span><span class="label">Dashboard</span></a></li>
                    <li><a href="#" class="active"><span class="icon">üìä</span><span class="label">Grades</span></a></li>
                    <li><a href="#"><span class="icon">‚öôÔ∏è</span><span class="label">Settings</span></a></li>
                </ul>
            </nav>
        </aside>

        <main class="main-content">
            <div class="page-header-v4"> 
                <h2 class="page-title-v4">GRADE CHECKER üìä</h2> 
                <button id="logoutBtn" class="btn btn-logout hidden">Log Out</button>
            </div>
            <div class="status-message-v4" id="statusMessageV4"></div>

            <div id="login-container">
                <form id="loginForm">
                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" id="username" placeholder="Enter your username" required>
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" placeholder="Enter your password" required>
                    </div>
                    <div class="form-group">
                        <label for="district">School District</label>
                        <input type="text" id="district" placeholder="e.g., Northside ISD" required>
                    </div>
                    <button type="submit" id="loginBtn" class="btn btn-primary">Check Grades</button>
                </form>
            </div>
            
            <div id="gradesView" class="hidden"></div>
        </main>
    </div>

    <div id="classDetailsModal" class="modal-backdrop">
        <div class="modal-content">
            <div class="modal-header"> 
                <h2 id="classModalTitle">Class Details</h2> 
                <button id="closeModalBtn" class="close-btn"><img src="../images/cross-white.png" alt="Close"></button>
            </div>
            <div class="modal-body">
                <div id="classAssignmentsContainer" class="assignments-container">
                    </div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // --- FAKE HAC API SIMULATION ---
        // In a real application, this would be a series of `fetch` calls to a backend server.
        // For this demonstration, we simulate the API to show how the front-end would work.
        const FAKE_HAC_API = {
            login: async (username, password, district) => {
                // Simulate network delay
                await new Promise(resolve => setTimeout(resolve, 1500));

                // Basic validation
                if (!username || !password || !district) {
                    return { success: false, message: "Username, password, and district are required." };
                }

                // Simulate incorrect login
                if (username.toLowerCase() === 'student' && password === 'fail') {
                    return { success: false, message: "Invalid username or password." };
                }

                // On successful login, return fake grade data
                return {
                    success: true,
                    data: {
                        studentName: "Alex Doe",
                        classes: [
                            {
                                id: "ALG2-101",
                                className: "Algebra II",
                                teacherName: "Mr. Davison",
                                average: 94,
                                assignments: [
                                    { name: "Unit 5 Test", category: "Tests", score: 92, totalPoints: 100 },
                                    { name: "Homework 5.1", category: "Homework", score: 10, totalPoints: 10 },
                                    { name: "Quadratic Formula Quiz", category: "Quizzes", score: 95, totalPoints: 100 },
                                    { name: "Homework 5.2", category: "Homework", score: 9, totalPoints: 10 },
                                ]
                            },
                            {
                                id: "ENG3-204",
                                className: "English III",
                                teacherName: "Ms. Orwell",
                                average: 88,
                                assignments: [
                                    { name: "The Great Gatsby Essay", category: "Essays", score: 85, totalPoints: 100 },
                                    { name: "Vocabulary Quiz 8", category: "Quizzes", score: 92, totalPoints: 100 },
                                    { name: "Chapter 5 Reading Questions", category: "Homework", score: 10, totalPoints: 10 },
                                ]
                            },
                            {
                                id: "CHEM1-301",
                                className: "Chemistry",
                                teacherName: "Dr. Curie",
                                average: 91,
                                assignments: [
                                    { name: "Lab Report: Titration", category: "Labs", score: 95, totalPoints: 100 },
                                    { name: "Stoichiometry Exam", category: "Tests", score: 88, totalPoints: 100 },
                                    { name: "Worksheet 3.4", category: "Homework", score: 10, totalPoints: 10 },
                                ]
                            },
                            {
                                id: "USH-402",
                                className: "US History",
                                teacherName: "Mr. Washington",
                                average: 96,
                                assignments: [
                                    { name: "Civil War Presentation", category: "Projects", score: 98, totalPoints: 100 },
                                    { name: "Chapter 12 Quiz", category: "Quizzes", score: 90, totalPoints: 100 },
                                    { name: "Midterm Exam", category: "Tests", score: 97, totalPoints: 100 },
                                ]
                            }
                        ]
                    }
                };
            }
        };

        // --- UI Element References ---
        const loginContainer = document.getElementById('login-container');
        const loginForm = document.getElementById('loginForm');
        const loginBtn = document.getElementById('loginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const gradesView = document.getElementById('gradesView');
        const classDetailsModal = document.getElementById('classDetailsModal');
        const classModalTitle = document.getElementById('classModalTitle');
        const classAssignmentsContainer = document.getElementById('classAssignmentsContainer');
        const closeModalBtn = document.getElementById('closeModalBtn');
        
        let gradeDataCache = null;

        // --- UI Helper Functions ---
        const showStatus = (message, type = 'info', duration = 4000) => { 
            const el = document.getElementById('statusMessageV4'); 
            clearTimeout(el.timeoutId); 
            el.textContent = message; 
            el.className = `status-message-v4 ${type}`; 
            el.style.display = 'block'; 
            el.timeoutId = setTimeout(() => el.style.display = 'none', duration); 
        };

        // --- Rendering Functions ---
        function renderGrades(data) {
            gradesView.innerHTML = ''; // Clear previous grades
            gradeDataCache = data; // Cache data for modal use

            data.classes.forEach(course => {
                const card = document.createElement('div');
                card.className = 'class-card';
                card.dataset.classId = course.id;

                card.innerHTML = `
                    <div class="class-card-header">
                        <div class="class-info">
                            <div class="class-title">${course.className}</div>
                            <div class="class-teacher">${course.teacherName}</div>
                        </div>
                        <div class="class-grade-display">${course.average}</div>
                    </div>
                `;

                card.addEventListener('click', () => openClassDetailsModal(course.id));
                gradesView.appendChild(card);
            });

            loginContainer.classList.add('hidden');
            gradesView.classList.remove('hidden');
            logoutBtn.classList.remove('hidden');
        }

        function openClassDetailsModal(classId) {
            const course = gradeDataCache.classes.find(c => c.id === classId);
            if (!course) return;

            classModalTitle.textContent = `${course.className} - Assignments`;
            
            // Group assignments by category
            const assignmentsByCategory = course.assignments.reduce((acc, assignment) => {
                if (!acc[assignment.category]) {
                    acc[assignment.category] = [];
                }
                acc[assignment.category].push(assignment);
                return acc;
            }, {});

            classAssignmentsContainer.innerHTML = ''; // Clear previous assignments
            for (const category in assignmentsByCategory) {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'assignment-category';
                
                const categoryTitle = document.createElement('h3');
                categoryTitle.className = 'assignment-category-title';
                categoryTitle.textContent = category;
                categoryDiv.appendChild(categoryTitle);

                assignmentsByCategory[category].forEach(assignment => {
                    const row = document.createElement('div');
                    row.className = 'assignment-row';
                    row.innerHTML = `
                        <span class="assignment-name">${assignment.name}</span>
                        <span class="assignment-score">${assignment.score} / ${assignment.totalPoints}</span>
                    `;
                    categoryDiv.appendChild(row);
                });
                classAssignmentsContainer.appendChild(categoryDiv);
            }

            classDetailsModal.classList.add('visible');
        }

        function closeClassDetailsModal() {
            classDetailsModal.classList.remove('visible');
        }

        function handleLogout() {
            gradeDataCache = null;
            gradesView.classList.add('hidden');
            gradesView.innerHTML = '';
            logoutBtn.classList.add('hidden');
            loginContainer.classList.remove('hidden');
            showStatus('You have been logged out.', 'info');
        }

        // --- Event Listeners ---
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const district = document.getElementById('district').value;

            loginBtn.disabled = true;
            loginBtn.textContent = 'Loading...';
            showStatus('Attempting to retrieve grades...', 'info');

            const response = await FAKE_HAC_API.login(username, password, district);

            loginBtn.disabled = false;
            loginBtn.textContent = 'Check Grades';

            if (response.success) {
                showStatus(`Welcome, ${response.data.studentName}! Grades loaded successfully.`, 'success');
                renderGrades(response.data);
            } else {
                showStatus(response.message, 'error');
            }
        });

        logoutBtn.addEventListener('click', handleLogout);
        closeModalBtn.addEventListener('click', closeClassDetailsModal);
        classDetailsModal.addEventListener('click', (e) => {
            // Close modal if backdrop is clicked
            if (e.target === classDetailsModal) {
                closeClassDetailsModal();
            }
        });
    });
    </script>
</body>
</html>
