<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>4SP – Dashboard</title>
  <link rel="stylesheet" href="../css/style.css" />
  <style>
    /* ─── Base Layout ───────────────────────────────────────────────────── */
    body.dashboard-page {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      margin: 0;
      font-family: 'PrimaryFont', sans-serif;
      background: #f0f2f5;
    }
    .dashboard-container {
      display: flex;
      flex: 1;
    }
    header.main-header {
      background: white;
      padding: 12px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      position: relative;
      z-index: 3000;
    }
    header .logo img {
      height: 40px;
      cursor: pointer;
    }
    header .auth-buttons {
      display: flex;
      gap: 12px;
    }
    header .auth-buttons .btn-login {
      background: linear-gradient(135deg, #6720bd 0%, #8a2be2 100%);
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9em;
      transition: background 0.3s;
    }
    header .auth-buttons .btn-login:hover {
      background: linear-gradient(135deg, #5a1ca0 0%, #7121c5 100%);
    }
    header .auth-buttons .btn-tutorial {
      background: #ffc107;
      color: #333;
      border: none;
      padding: 8px 14px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9em;
      transition: background 0.3s;
    }
    header .auth-buttons .btn-tutorial:hover {
      background: #e0a800;
    }

    /* ─── Sidebar ───────────────────────────────────────────────────── */
    .sidebar {
      width: 200px;
      background: linear-gradient(180deg, #333 0%, #2a2a2a 100%);
      color: white;
      padding: 20px 10px;
      display: flex;
      flex-direction: column;
      border-right: 1px solid #444;
      box-shadow: 2px 0 10px rgba(0,0,0,0.1);
      transition: width 0.3s ease;
    }
    .sidebar.collapsed {
      width: 85px;
    }
    #toggleSidebar {
      background: none;
      border: none;
      color: white;
      font-size: 1.2em;
      cursor: pointer;
      margin-bottom: 20px;
      align-self: center;
      transition: transform 0.3s ease;
    }
    .sidebar.collapsed #toggleSidebar {
      transform: rotate(180deg);
    }
    .user-info {
      text-align: center;
      margin-bottom: 30px;
      border-bottom: 1px solid #555;
      padding-bottom: 20px;
      overflow: visible;
    }
    .user-info .username {
      font-size: 1.2em;
      font-weight: bold;
      margin-bottom: 4px;
      color: #fff;
    }
    .user-info .email {
      font-size: 0.85em;
      color: #ccc;
    }
    .sidebar nav ul {
      list-style: none;
      padding: 0;
      margin: 20px 0 0;
    }
    .sidebar nav li {
      margin-bottom: 12px;
    }
    .sidebar nav a {
      display: flex;
      align-items: center;
      padding: 10px 14px;
      color: white;
      text-decoration: none;
      border-radius: 8px;
      transition: background 0.3s, transform 0.2s;
    }
    .sidebar nav a:hover,
    .sidebar nav a.active {
      background: linear-gradient(135deg, #6720bd 0%, #8a2be2 100%);
      transform: translateX(4px);
    }
    .sidebar nav a .icon {
      font-size: 1.1em;
      width: 24px;
      text-align: center;
    }
    .sidebar nav a .label {
      margin-left: 10px;
      white-space: nowrap;
    }
    .sidebar.collapsed nav a .label {
      display: none;
    }
    .sidebar.collapsed nav a {
      justify-content: center;
      padding: 10px 0;
    }

    /* ─── Main Content & Controls ───────────────────────────────────────────────────── */
    .main-content {
      flex: 1;
      padding: 20px 30px;
      position: relative;
      overflow-y: auto;
    }
    .dashboard-header {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .dashboard-title {
      font-size: 2em;
      font-weight: bold;
      background: linear-gradient(135deg, #6720bd 0%, #8a2be2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .dashboard-controls {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-top: 10px;
    }
    .control-btn {
      background: linear-gradient(135deg, #6720bd 0%, #8a2be2 100%);
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9em;
      transition: background 0.3s;
    }
    .control-btn:hover {
      background: linear-gradient(135deg, #5a1ca0 0%, #7121c5 100%);
    }
    .control-btn.secondary {
      background: #6c757d;
    }
    .control-btn.secondary:hover {
      background: #5c636a;
    }

    /* ─── Quick Actions ───────────────────────────────────────────────────── */
    .quick-actions {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      border: 1px solid rgba(103,32,189,0.1);
    }
    .quick-actions h3 {
      margin: 0 0 12px;
      font-size: 1.3em;
      color: #333;
      display: flex;
      align-items: center;
    }
    .quick-actions h3::before {
      content: '⚡';
      margin-right: 8px;
      font-size: 1.1em;
    }
    .action-buttons {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    .action-btn {
      background: #f8f9fa;
      border: 2px solid rgba(103,32,189,0.2);
      color: #6720bd;
      padding: 10px 14px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s, transform 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
      font-weight: 600;
      font-size: 0.9em;
    }
    .action-btn:hover {
      background: linear-gradient(135deg, #6720bd 0%, #8a2be2 100%);
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(103,32,189,0.3);
    }

    /* ─── Dashboard Grid & Cards ───────────────────────────────────────────────────── */
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 24px;
      position: relative;
    }
    .dashboard-card {
      background: white;
      border-radius: 12px;
      padding: 14px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      border: 1px solid rgba(103,32,189,0.1);
      cursor: pointer;
      display: flex;
      flex-direction: column;
      position: relative;
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .dashboard-card:hover {
      transform: translateY(-6px) scale(1.02);
      box-shadow: 0 12px 30px rgba(103,32,189,0.15);
      border-color: rgba(103,32,189,0.3);
    }
    .dashboard-card[data-card-type="full"] {
      grid-column: span 1;
      min-height: 200px;
    }
    .dashboard-card[data-card-type="large"] {
      grid-column: span 2;
      min-height: 200px;
    }
    .card-header {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
      border-bottom: 1px solid rgba(103,32,189,0.1);
      padding-bottom: 6px;
    }
    .card-icon {
      font-size: 1.8em;
      margin-right: 8px;
      background: linear-gradient(135deg, #6720bd 0%, #8a2be2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      filter: drop-shadow(0 1px 3px rgba(103,32,189,0.2));
    }
    .card-title {
      font-size: 1.1em;
      font-weight: bold;
      color: #333;
      flex-grow: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .card-header-actions {
      display: none;
      gap: 6px;
    }
    .card-action-btn {
      background: rgba(0,0,0,0.05);
      color: #555;
      border: 1px solid rgba(0,0,0,0.15);
      width: 24px;
      height: 24px;
      border-radius: 50%;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background 0.2s, transform 0.2s;
    }
    .card-action-btn:hover {
      background: rgba(0,0,0,0.1);
      transform: scale(1.1);
    }
    .card-action-btn.delete-btn {
      color: #dc3545;
      border-color: rgba(220,53,69,0.5);
    }
    .card-action-btn.delete-btn:hover {
      background: #dc3545;
      border-color: #dc3545;
      color: white;
    }
    .card-action-btn.edit-btn {
      color: #007bff;
      border-color: rgba(0,123,255,0.5);
    }
    .card-action-btn.edit-btn:hover {
      background: #007bff;
      border-color: #007bff;
      color: white;
    }
    .card-content-inner {
      flex-grow: 1;
      margin-top: 6px;
    }
    .card-description {
      color: #666;
      font-size: 0.9em;
      line-height: 1.4;
      margin-bottom: 8px;
      overflow: auto;
    }

    /* ─── Forecast (Horizontal) ───────────────────────────────────────────── */
    .weather-horizontal {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .current-weather {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .weather-icon {
      font-size: 2em;
    }
    .temp-now {
      font-size: 1.6em;
      font-weight: bold;
    }
    .condition-now {
      font-size: 0.95em;
      color: #333;
    }
    .details-now {
      font-size: 0.85em;
      color: #555;
      margin-top: 4px;
    }
    .forecast-schedule {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 6px;
      margin-top: 8px;
    }
    .forecast-cell {
      background: #f8f9fa;
      border-radius: 6px;
      padding: 6px;
      text-align: center;
      font-size: 0.85em;
      color: #333;
    }
    .forecast-cell .day-name {
      font-weight: bold;
      margin-bottom: 4px;
    }
    .forecast-cell .day-icon {
      font-size: 1.2em;
      margin-bottom: 4px;
    }
    .forecast-cell .day-temps {
      color: #555;
    }

    /* ─── Calculator Styles ───────────────────────────────────────────────── */
    .calc-container {
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    #calc_display {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1.2em;
      margin-bottom: 8px;
      text-align: right;
      background: #f8f9fa;
    }
    .calc-buttons {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 6px;
      flex-grow: 1;
    }
    .calc-btn {
      background: #e9ecef;
      border: none;
      border-radius: 6px;
      font-size: 1.1em;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
    }
    .calc-btn:hover {
      background: #d6d8db;
      transform: translateY(-2px);
    }

    /* ─── Dictionary Styles ──────────────────────────────────────────────── */
    .dict-container {
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    #dictionary_input {
      width: 100%;
      padding: 6px;
      border: 1px solid #ccc;
      border-radius: 6px;
      margin-bottom: 6px;
      background: #f8f9fa;
    }
    #dictionary_lookup_btn {
      background: #6720bd;
      color: white;
      border: none;
      padding: 6px 10px;
      border-radius: 6px;
      font-size: 0.9em;
      cursor: pointer;
      transition: background 0.3s;
      margin-bottom: 8px;
    }
    #dictionary_lookup_btn:hover {
      background: #5a1ca0;
    }
    #dictionary_result {
      flex-grow: 1;
      font-size: 0.9em;
      color: #333;
      overflow-y: auto;
      background: #f8f9fa;
      padding: 6px;
      border-radius: 6px;
    }

    /* ─── Random Fact / Joke Styles ───────────────────────────────────────── */
    .text-output {
      font-size: 0.95em;
      color: #333;
      flex-grow: 1;
      overflow-y: auto;
      background: #f8f9fa;
      padding: 8px;
      border-radius: 6px;
    }
    .text-output p {
      margin: 0;
    }
    .text-action-btn {
      margin-top: 8px;
      background: #6720bd;
      color: white;
      border: none;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s;
      font-size: 0.9em;
    }
    .text-action-btn:hover {
      background: #5a1ca0;
    }

    /* ─── World Clock Styles ─────────────────────────────────────────────── */
    .clock-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 6px;
      height: 100%;
    }
    .clock-display {
      font-size: 1.6em;
      font-weight: bold;
      color: #333;
    }
    .clock-label {
      font-size: 0.9em;
      color: #555;
    }

    /* ─── Tutorial Overlay ───────────────────────────────────────────────── */
    #tutorialOverlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 2000;
    }
    #tutorialContent {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 300px;
      background: white;
      padding: 20px;
      border-radius: 8px;
      transform: translate(-50%, -50%);
      z-index: 2001;
      font-size: 0.95em;
      color: #333;
    }
    #tutorialContent h3 {
      margin-top: 0;
      font-size: 1.2em;
    }
    #tutorialContent ul {
      padding-left: 20px;
      margin: 10px 0;
    }
    #tutorialContent button {
      background: #dc3545;
      color: white;
      border: none;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s;
      font-size: 0.9em;
    }
    #tutorialContent button:hover {
      background: #c82333;
    }
    /* Highlight selected elements */
    .highlight {
      position: relative;
      z-index: 2002 !important;
      box-shadow: 0 0 0 4px rgba(255,235,59,0.8);
      border-radius: 8px;
    }

    /* ─── Responsive Adjustments ───────────────────────────────────────────── */
    @media (max-width: 768px) {
      .dashboard-grid {
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      }
      .dashboard-card[data-card-type="large"] {
        grid-column: span 1;
      }
      .dashboard-header {
        flex-direction: column;
        gap: 12px;
        text-align: center;
      }
      .dashboard-controls {
        justify-content: center;
      }
      .quick-actions {
        margin-bottom: 16px;
      }
    }
  </style>
</head>

<body class="dashboard-page">
  <header class="main-header" id="mainHeader">
    <div class="logo">
      <a href="../index.html"><img src="../images/logo-dark.png" alt="4SP Logo" /></a>
    </div>
    <div class="auth-buttons">
      <button class="btn-tutorial" id="openTutorialBtn">Tutorial</button>
      <button class="btn-login" onclick="window.location.href='../index.html'">HOME</button>
      <button id="logoutBtn" class="btn-login">LOG OUT</button>
    </div>
  </header>

  <div class="dashboard-container">
    <aside class="sidebar" id="sidebar">
      <button id="toggleSidebar">☰</button>
      <div class="user-info">
        <div id="sidebarUsername" class="username">Loading…</div>
        <div id="sidebarEmail" class="email">Loading…</div>
      </div>
      <nav>
        <ul>
          <li><a href="dashboard.html" class="active"><span class="icon">🏠</span><span class="label">Dashboard</span></a></li>
          <li><a href="proxies.html"><span class="icon">🛡️</span><span class="label">Proxies</span></a></li>
          <li><a href="soundboard.html"><span class="icon">🎵</span><span class="label">Soundboard</span></a></li>
          <li><a href="games.html"><span class="icon">🎮</span><span class="label">Games</span></a></li>
          <li><a href="settings.html"><span class="icon">⚙️</span><span class="label">Settings</span></a></li>
        </ul>
      </nav>
    </aside>

    <main class="main-content">
      <div class="dashboard-header">
        <h2 class="dashboard-title">Dashboard</h2>
        <div class="dashboard-controls">
          <button id="editDashboard" class="control-btn">Edit Layout</button>
          <button id="resetLayoutBtn" class="control-btn secondary">Reset</button>
        </div>
      </div>

      <div class="quick-actions" id="quickActions">
        <h3>Quick Actions</h3>
        <div class="action-buttons">
          <button class="action-btn" onclick="window.location.href='proxies.html'">
            <span>🛡️</span> Launch Proxy
          </button>
          <button class="action-btn" onclick="window.location.href='games.html'">
            <span>🎮</span> Play Games
          </button>
          <button class="action-btn" onclick="window.location.href='soundboard.html'">
            <span>🎵</span> Open Soundboard
          </button>
          <button class="action-btn" onclick="window.location.href='settings.html'">
            <span>⚙️</span> Settings
          </button>
        </div>
      </div>

      <div class="dashboard-grid" id="dashboardGrid">
        <!-- 1) Weather (spans 2 columns) -->
        <div class="dashboard-card" data-card-type="large" data-id="weather_card" data-template-id="weather_widget" id="weatherCard">
          <div class="card-header">
            <div class="card-icon">🌦️</div>
            <h4 class="card-title">Weekly Weather</h4>
            <div class="card-header-actions">
              <button class="card-action-btn edit-btn" data-action="edit">✎</button>
              <button class="card-action-btn delete-btn" data-action="delete">✕</button>
            </div>
          </div>
          <div class="card-content-inner weather-horizontal">
            <div class="current-weather">
              <span class="weather-icon" id="currentIcon">⏳</span>
              <div>
                <div class="temp-now" id="currentTemp">--°</div>
                <div class="condition-now" id="currentCondition">Loading…</div>
                <div class="details-now" id="currentDetails">
                  <span>Wind: --</span> | <span>Humidity: --%</span>
                </div>
              </div>
            </div>
            <div class="forecast-schedule" id="forecastSchedule">
              <!-- Forecast cells injected here -->
            </div>
            <small style="text-align:center; color:#aaa; font-size:0.7em;">Weather by Open-Meteo.com</small>
          </div>
        </div>

        <!-- 2) Username Card -->
        <div class="dashboard-card" data-card-type="full" data-id="username_card" data-template-id="username_widget" id="usernameCard">
          <div class="card-header">
            <div class="card-icon">👤</div>
            <h4 class="card-title">Your Info</h4>
            <div class="card-header-actions">
              <button class="card-action-btn edit-btn" data-action="edit">✎</button>
              <button class="card-action-btn delete-btn" data-action="delete">✕</button>
            </div>
          </div>
          <div class="card-content-inner">
            <p class="card-description" id="usernameDisplay">Loading username…</p>
            <p class="card-description" id="userEmailDisplay">Loading email…</p>
          </div>
        </div>

        <!-- 3) Calculator Card -->
        <div class="dashboard-card" data-card-type="full" data-id="calculator_card" data-template-id="calculator_widget" id="calculatorCard">
          <div class="card-header">
            <div class="card-icon">🧮</div>
            <h4 class="card-title">Calculator</h4>
            <div class="card-header-actions">
              <button class="card-action-btn edit-btn" data-action="edit">✎</button>
              <button class="card-action-btn delete-btn" data-action="delete">✕</button>
            </div>
          </div>
          <div class="card-content-inner calc-container">
            <input type="text" id="calc_display" readonly />
            <div class="calc-buttons">
              <button class="calc-btn">7</button>
              <button class="calc-btn">8</button>
              <button class="calc-btn">9</button>
              <button class="calc-btn">/</button>
              <button class="calc-btn">4</button>
              <button class="calc-btn">5</button>
              <button class="calc-btn">6</button>
              <button class="calc-btn">*</button>
              <button class="calc-btn">1</button>
              <button class="calc-btn">2</button>
              <button class="calc-btn">3</button>
              <button class="calc-btn">-</button>
              <button class="calc-btn">0</button>
              <button class="calc-btn">.</button>
              <button class="calc-btn">=</button>
              <button class="calc-btn">+</button>
            </div>
          </div>
        </div>

        <!-- 4) Dictionary Card -->
        <div class="dashboard-card" data-card-type="full" data-id="dictionary_card" data-template-id="dictionary_widget" id="dictionaryCard">
          <div class="card-header">
            <div class="card-icon">📖</div>
            <h4 class="card-title">Dictionary</h4>
            <div class="card-header-actions">
              <button class="card-action-btn edit-btn" data-action="edit">✎</button>
              <button class="card-action-btn delete-btn" data-action="delete">✕</button>
            </div>
          </div>
          <div class="card-content-inner dict-container">
            <input type="text" id="dictionary_input" placeholder="Enter a word…" />
            <button id="dictionary_lookup_btn">Lookup</button>
            <div id="dictionary_result" class="text-output">Definition will appear here.</div>
          </div>
        </div>

        <!-- 5) Random Joke Card -->
        <div class="dashboard-card" data-card-type="full" data-id="random_joke_card" data-template-id="random_joke_widget" id="randomJokeCard">
          <div class="card-header">
            <div class="card-icon">🤣</div>
            <h4 class="card-title">Random Joke</h4>
            <div class="card-header-actions">
              <button class="card-action-btn edit-btn" data-action="edit">✎</button>
              <button class="card-action-btn delete-btn" data-action="delete">✕</button>
            </div>
          </div>
          <div class="card-content-inner">
            <div id="jokeOutput" class="text-output">Press button to get a joke.</div>
            <button id="getJokeBtn" class="text-action-btn">Get Joke</button>
          </div>
        </div>

        <!-- 6) To-Do List Card -->
        <div class="dashboard-card" data-card-type="full" data-id="todo_card" data-template-id="todo_widget" id="todoCard">
          <div class="card-header">
            <div class="card-icon">✅</div>
            <h4 class="card-title">To-Do List</h4>
            <div class="card-header-actions">
              <button class="card-action-btn edit-btn" data-action="edit">✎</button>
              <button class="card-action-btn delete-btn" data-action="delete">✕</button>
            </div>
          </div>
          <div class="card-content-inner">
            <input type="text" id="todoInput" placeholder="New task…" style="width:100%; padding:6px; border:1px solid #ccc; border-radius:6px; margin-bottom:6px;"/>
            <button id="addTodoBtn" class="text-action-btn">Add Task</button>
            <ul id="todoList" style="margin-top:8px; padding-left:20px; color:#333; font-size:0.9em; max-height:120px; overflow-y:auto;"></ul>
          </div>
        </div>

        <!-- 7) World Clock Card -->
        <div class="dashboard-card" data-card-type="full" data-id="clock_card" data-template-id="clock_widget" id="clockCard">
          <div class="card-header">
            <div class="card-icon">🌍</div>
            <h4 class="card-title">World Clock</h4>
            <div class="card-header-actions">
              <button class="card-action-btn edit-btn" data-action="edit">✎</button>
              <button class="card-action-btn delete-btn" data-action="delete">✕</button>
            </div>
          </div>
          <div class="card-content-inner clock-container">
            <div class="clock-display" id="clockDisplay">--:--:--</div>
            <div class="clock-label">Local Time</div>
          </div>
        </div>

        <!-- 8) Random Fact Card -->
        <div class="dashboard-card" data-card-type="full" data-id="random_fact_card" data-template-id="random_fact_widget" id="randomFactCard">
          <div class="card-header">
            <div class="card-icon">🧠</div>
            <h4 class="card-title">Random Fact</h4>
            <div class="card-header-actions">
              <button class="card-action-btn edit-btn" data-action="edit">✎</button>
              <button class="card-action-btn delete-btn" data-action="delete">✕</button>
            </div>
          </div>
          <div class="card-content-inner">
            <div id="factOutput" class="text-output">Press button for a fact.</div>
            <button id="getFactBtn" class="text-action-btn">Get Fact</button>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- ─── Tutorial Overlay ───────────────────────────────────────────────────── -->
  <div id="tutorialOverlay">
    <div id="tutorialContent">
      <h3>Tutorial</h3>
      <p>Welcome to your Dashboard! Here’s a quick guide:</p>
      <ul>
        <li><strong>Weather Card</strong>: Shows the 7-day forecast.</li>
        <li><strong>Your Info</strong>: Displays your username and email.</li>
        <li><strong>Calculator</strong>: Perform quick calculations.</li>
        <li><strong>Dictionary</strong>: Look up word definitions.</li>
        <li><strong>Random Joke</strong>: Get a quick joke.</li>
        <li><strong>To-Do List</strong>: Add and manage tasks.</li>
        <li><strong>World Clock</strong>: Displays your local time.</li>
        <li><strong>Random Fact</strong>: Get a fun fact.</li>
      </ul>
      <button id="closeTutorialBtn">Close Tutorial</button>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
  <script src="../firebase-config.js"></script>
  <script>
    // ─── Globals & References ───────────────────────────────────────────────────
    const dbRef = () => 
      firebase.auth().currentUser 
        ? firebase.firestore().collection('users').doc(firebase.auth().currentUser.uid)
        : null;
    let editMode = false;

    // DOM Elements
    const sidebar = document.getElementById('sidebar');
    const toggleSidebarBtn = document.getElementById('toggleSidebar');
    const dashboardGrid = document.getElementById('dashboardGrid');
    const editBtn = document.getElementById('editDashboard');
    const resetBtn = document.getElementById('resetLayoutBtn');
    const openTutorialBtn = document.getElementById('openTutorialBtn');
    const closeTutorialBtn = document.getElementById('closeTutorialBtn');
    const tutorialOverlay = document.getElementById('tutorialOverlay');

    // Firebase & User Info Elements
    const sidebarUsername = document.getElementById('sidebarUsername');
    const sidebarEmail = document.getElementById('sidebarEmail');
    const usernameDisplay = document.getElementById('usernameDisplay');
    const userEmailDisplay = document.getElementById('userEmailDisplay');

    // Weather Elements
    const currentIconEl = document.getElementById('currentIcon');
    const currentTempEl = document.getElementById('currentTemp');
    const currentConditionEl = document.getElementById('currentCondition');
    const currentDetailsEl = document.getElementById('currentDetails');
    const forecastScheduleEl = document.getElementById('forecastSchedule');

    // Calculator Elements
    const calcDisplay = document.getElementById('calc_display');
    const calcButtons = document.querySelectorAll('.calc-btn');

    // Dictionary Elements
    const dictInput = document.getElementById('dictionary_input');
    const dictLookupBtn = document.getElementById('dictionary_lookup_btn');
    const dictResult = document.getElementById('dictionary_result');

    // Random Joke Elements
    const jokeOutput = document.getElementById('jokeOutput');
    const getJokeBtn = document.getElementById('getJokeBtn');

    // To-Do List Elements
    const todoInput = document.getElementById('todoInput');
    const addTodoBtn = document.getElementById('addTodoBtn');
    const todoListEl = document.getElementById('todoList');

    // World Clock Elements
    const clockDisplay = document.getElementById('clockDisplay');

    // Random Fact Elements
    const factOutput = document.getElementById('factOutput');
    const getFactBtn = document.getElementById('getFactBtn');

    // Tutorial Highlights
    const highlightElements = [
      document.getElementById('mainHeader'),
      document.getElementById('quickActions'),
      document.getElementById('weatherCard'),
      document.getElementById('usernameCard'),
      document.getElementById('calculatorCard')
    ];

    // ─── WMO Codes for Weather ───────────────────────────────────────────────
    const WMO_CODES = {
      0: { description: "Clear sky", icon: "☀️" },
      1: { description: "Mainly clear", icon: "🌤️" },
      2: { description: "Partly cloudy", icon: "🌥️" },
      3: { description: "Overcast", icon: "☁️" },
      45: { description: "Fog", icon: "🌫️" },
      48: { description: "Depositing rime fog", icon: "🌫️" },
      51: { description: "Light drizzle", icon: "🌦️" },
      53: { description: "Moderate drizzle", icon: "🌦️" },
      55: { description: "Dense drizzle", icon: "🌦️" },
      56: { description: "Light freezing drizzle", icon: "🌨️" },
      57: { description: "Dense freezing drizzle", icon: "🌨️" },
      61: { description: "Slight rain", icon: "🌧️" },
      63: { description: "Moderate rain", icon: "🌧️" },
      65: { description: "Heavy rain", icon: "🌧️" },
      66: { description: "Light freezing rain", icon: "🌨️" },
      67: { description: "Heavy freezing rain", icon: "🌨️" },
      71: { description: "Slight snow fall", icon: "❄️" },
      73: { description: "Moderate snow fall", icon: "❄️" },
      75: { description: "Heavy snow fall", icon: "❄️" },
      77: { description: "Snow grains", icon: "❄️" },
      80: { description: "Slight rain showers", icon: "🌦️" },
      81: { description: "Moderate rain showers", icon: "🌦️" },
      82: { description: "Violent rain showers", icon: "⛈️" },
      85: { description: "Slight snow showers", icon: "🌨️" },
      86: { description: "Heavy snow showers", icon: "🌨️" },
      95: { description: "Thunderstorm", icon: "⛈️" },
      96: { description: "Thunderstorm with slight hail", icon: "⛈️" },
      99: { description: "Thunderstorm with heavy hail", icon: "⛈️" }
    };

    // ─── Initialize & Auth ───────────────────────────────────────────────────
    firebase.auth().onAuthStateChanged(async user => {
      if (!user) {
        return location.href = '../login.html';
      }
      const userEmail = user.email || '';
      const userName = user.displayName || userEmail.split('@')[0] || 'User';

      // Fill sidebar and username card
      sidebarUsername.textContent = userName;
      sidebarEmail.textContent = userEmail;
      usernameDisplay.textContent = `Name: ${userName}`;
      userEmailDisplay.textContent = `Email: ${userEmail}`;

      // Load weather with default coordinates
      initWeather(40.7909, -81.5218, 'imperial');

      // Initialize calculator
      initCalculator();

      // Initialize dictionary
      initDictionary();

      // Initialize random joke
      initRandomJoke();

      // Initialize to-do list
      initTodoList();

      // Initialize clock
      initClock();

      // Initialize random fact
      initRandomFact();

      // Attach edit/delete button actions
      attachCardActions();
    });

    // ─── Sidebar Toggle ───────────────────────────────────────────────────────
    toggleSidebarBtn.addEventListener('click', () => {
      sidebar.classList.toggle('collapsed');
    });

    // ─── Reset Layout ─────────────────────────────────────────────────────────
    resetBtn.addEventListener('click', () => {
      if (confirm('Reset dashboard to default layout?')) {
        window.location.reload();
      }
    });

    // ─── Edit Layout Mode ────────────────────────────────────────────────────
    function attachCardActions() {
      document.querySelectorAll('.edit-btn').forEach(btn => {
        btn.addEventListener('click', e => {
          e.stopPropagation();
          alert('Edit functionality not implemented in this demo.');
        });
      });
      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', e => {
          e.stopPropagation();
          const card = e.target.closest('.dashboard-card');
          if (confirm('Remove this card?')) {
            card.remove();
          }
        });
      });
    }

    // ─── Weather Logic ────────────────────────────────────────────────────────
    async function initWeather(lat, lon, units) {
      const displayError = (msg) => {
        currentConditionEl.textContent = msg;
        currentIconEl.textContent = '⚠️';
        currentTempEl.textContent = '';
        forecastScheduleEl.innerHTML = `<div style="color:red; text-align:center; font-size:0.9em;">${msg}</div>`;
      };
      try {
        const tempParam = units === 'metric' ? 'celsius' : 'fahrenheit';
        const windParam = units === 'metric' ? 'kmh' : 'mph';
        const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&daily=weathercode,temperature_2m_max,temperature_2m_min&temperature_unit=${tempParam}&wind_speed_unit=${windParam}&timezone=auto&forecast_days=7`;
        const resp = await fetch(url);
        if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
        const data = await resp.json();

        const cw = data.current_weather;
        const cwInfo = WMO_CODES[cw.weathercode] || { description: 'Unknown', icon: '❓' };
        currentIconEl.textContent = cwInfo.icon;
        currentTempEl.textContent = `${Math.round(cw.temperature)}${units==='metric'?'°C':'°F'}`;
        currentConditionEl.textContent = cwInfo.description;
        currentDetailsEl.innerHTML = `Wind: ${Math.round(cw.windspeed)}${units==='metric'?' km/h':' mph'} | Humidity: N/A`;

        // Forecast schedule
        forecastScheduleEl.innerHTML = '';
        const daily = data.daily;
        for (let i = 0; i < daily.time.length; i++) {
          const date = new Date(daily.time[i]);
          const dayName = i === 0 ? 'Today' : date.toLocaleDateString(undefined, { weekday: 'short' });
          const codeInfo = WMO_CODES[daily.weathercode[i]] || { icon: '❓' };
          const cell = document.createElement('div');
          cell.classList.add('forecast-cell');
          cell.innerHTML = `
            <div class="day-name">${dayName}</div>
            <div class="day-icon">${codeInfo.icon}</div>
            <div class="day-temps">${Math.round(daily.temperature_2m_max[i])}°/${Math.round(daily.temperature_2m_min[i])}°</div>
          `;
          forecastScheduleEl.appendChild(cell);
        }
      } catch (err) {
        console.error('Weather error:', err);
        displayError('Could not fetch weather.');
      }
    }

    // ─── Calculator Logic ─────────────────────────────────────────────────────
    function initCalculator() {
      calcButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          const val = btn.textContent;
          if (val === '=') {
            try {
              calcDisplay.value = eval(calcDisplay.value) || '';
            } catch {
              calcDisplay.value = 'Error';
            }
          } else {
            calcDisplay.value += val;
          }
        });
      });
    }

    // ─── Dictionary Logic ─────────────────────────────────────────────────────
    function initDictionary() {
      dictLookupBtn.addEventListener('click', async () => {
        const word = dictInput.value.trim();
        if (!word) return;
        dictResult.textContent = 'Looking up…';
        try {
          const resp = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
          if (!resp.ok) throw new Error('Not found');
          const arr = await resp.json();
          const def = arr[0].meanings[0].definitions[0].definition;
          dictResult.innerHTML = `<strong>${word}:</strong> ${def}`;
        } catch {
          dictResult.textContent = 'Definition not found.';
        }
      });
    }

    // ─── Random Joke Logic ────────────────────────────────────────────────────
    function initRandomJoke() {
      getJokeBtn.addEventListener('click', async () => {
        jokeOutput.textContent = 'Fetching joke…';
        try {
          const resp = await fetch('https://official-joke-api.appspot.com/jokes/random');
          if (!resp.ok) throw new Error('Error');
          const data = await resp.json();
          jokeOutput.innerHTML = `<p>${data.setup}</p><p><em>${data.punchline}</em></p>`;
        } catch {
          jokeOutput.textContent = 'Could not fetch joke.';
        }
      });
    }

    // ─── To-Do List Logic ─────────────────────────────────────────────────────
    function initTodoList() {
      const saved = JSON.parse(localStorage.getItem('todoItems') || '[]');
      saved.forEach(item => addTodoItem(item));
      addTodoBtn.addEventListener('click', () => {
        const txt = todoInput.value.trim();
        if (!txt) return;
        addTodoItem(txt);
        todoInput.value = '';
        persistTodos();
      });
    }
    function addTodoItem(text) {
      const li = document.createElement('li');
      li.textContent = text;
      li.style.cursor = 'pointer';
      li.addEventListener('click', () => {
        if (confirm('Remove this task?')) {
          li.remove();
          persistTodos();
        }
      });
      todoListEl.appendChild(li);
    }
    function persistTodos() {
      const arr = Array.from(todoListEl.children).map(li => li.textContent);
      localStorage.setItem('todoItems', JSON.stringify(arr));
    }

    // ─── World Clock Logic ────────────────────────────────────────────────────
    function initClock() {
      function updateClock() {
        const now = new Date();
        const timeStr = now.toLocaleTimeString();
        clockDisplay.textContent = timeStr;
      }
      updateClock();
      setInterval(updateClock, 1000);
    }

    // ─── Random Fact Logic ────────────────────────────────────────────────────
    function initRandomFact() {
      getFactBtn.addEventListener('click', () => {
        const facts = [
          'Honey never spoils.',
          'Bananas are berries, but strawberries aren’t.',
          'A day on Venus is longer than a year on Venus.',
          'Octopuses have three hearts.',
          'There are more stars in the universe than grains of sand on Earth.'
        ];
        const pick = facts[Math.floor(Math.random() * facts.length)];
        factOutput.textContent = pick;
      });
    }

    // ─── Tutorial Overlay Logic ──────────────────────────────────────────────
    openTutorialBtn.addEventListener('click', () => {
      tutorialOverlay.style.display = 'block';
      highlightElements.forEach(el => el.classList.add('highlight'));
    });
    closeTutorialBtn.addEventListener('click', () => {
      tutorialOverlay.style.display = 'none';
      highlightElements.forEach(el => el.classList.remove('highlight'));
    });

    // ─── Prevent Card Click Navigation When Editing/Highlighting ─────────────
    document.querySelectorAll('.dashboard-card').forEach(card => {
      card.addEventListener('click', e => {
        if (editMode) e.preventDefault();
      });
    });
  </script>
</body>
</html>
