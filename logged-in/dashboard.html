<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4SP - Dashboard</title>
    <link rel="stylesheet" href="../css/style.css"> <style>
        /* Specific CSS for Dashboard Layout */
        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .dashboard-container {
            display: flex;
            flex: 1;
            padding-top: 0; /* Remove top padding as header is separate */
        }

        .sidebar {
            width: 250px;
            background-color: #333; /* Dark background for sidebar */
            color: #fff;
            padding: 20px;
            box-shadow: 2px 0 5px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            border-right: 1px solid #444;
        }

        .sidebar .user-info {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #555;
        }

        .sidebar .user-info h3 {
            margin-bottom: 5px;
            color: #fff;
            font-family: 'PrimaryFont', sans-serif;
            font-size: 1.5em;
        }

        .sidebar .user-info p {
            font-size: 0.9em;
            color: #bbb;
        }

        .sidebar nav ul {
            list-style: none;
            padding: 0;
        }

        .sidebar nav ul li {
            margin-bottom: 10px;
        }

        .sidebar nav ul li a {
            display: block;
            padding: 10px 15px;
            color: #fff;
            text-decoration: none;
            border-radius: 8px;
            transition: background-color 0.3s ease, color 0.3s ease;
            font-family: 'SecondaryFont', sans-serif;
            font-size: 1.1em;
        }

        .sidebar nav ul li a:hover,
        .sidebar nav ul li a.active {
            background-color: #6720bd; /* Purple hover/active */
            color: #fff;
        }

        .main-content {
            flex: 1;
            padding: 40px;
            background-color: #f0f2f5; /* Light background for main content */
        }

        .main-content section {
            background-color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            margin-bottom: 30px;
            min-height: 400px; /* Ensure sections have some height */
        }

        .main-content section:not(.active-section) {
            display: none; /* Hide inactive sections */
        }

        .main-content h2 {
            font-family: 'PrimaryFont', sans-serif;
            font-size: 2.5em;
            color: #333;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        .main-content p {
            font-family: 'SecondaryFont', sans-serif;
            font-size: 1.1em;
            color: #555;
            line-height: 1.6;
        }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .dashboard-container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: auto; /* Allow sidebar to collapse */
                padding: 15px 0;
                border-right: none;
                border-bottom: 1px solid #444;
            }

            .sidebar .user-info {
                margin-bottom: 15px;
                padding-bottom: 15px;
            }

            .sidebar nav ul {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                gap: 10px;
            }

            .sidebar nav ul li {
                margin-bottom: 0;
            }

            .sidebar nav ul li a {
                padding: 8px 12px;
                font-size: 0.95em;
            }

            .main-content {
                padding: 20px;
            }

            .main-content section {
                padding: 20px;
                margin-bottom: 20px;
            }

            .main-content h2 {
                font-size: 2em;
            }
        }
    </style>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <script src="../firebase-config.js"></script> </head>
<body>
    <div class="top-bar-dark">
        <div class="container">
            <a href="#" class="top-bar-link">NEED HELP? CONTACT SUPPORT</a>
        </div>
    </div>

    <header class="main-header light-bg">
        <div class="container">
            <div class="logo">
                <img src="../images/logo-dark.png" alt="4SP Logo"> </div>
            <div class="auth-buttons">
                <button id="logoutBtn" class="btn btn-login">LOGOUT</button>
            </div>
        </div>
    </header>

    <div class="dashboard-container">
        <aside class="sidebar">
            <div class="user-info">
                <h3 id="userEmail">Loading...</h3>
                <p id="userName"></p>
            </div>
            <nav>
                <ul>
                    <li><a href="#" data-section="overview" class="active">Dashboard Overview</a></li>
                    <li><a href="#" data-section="proxy-list">Proxies</a></li>
                    <li><a href="#" data-section="soundboard">Soundboard</a></li>
                    <li><a href="#" data-section="games-list">Games</a></li>
                    <li><a href="#" data-section="settings">Settings</a></li>
                    <li><a href="#" id="signOutLink">Sign Out</a></li>
                </ul>
            </nav>
        </aside>

        <main class="main-content">
            <section id="overview-section" class="active-section">
                <h2>Dashboard Overview</h2>
                <p>Welcome to your 4SP dashboard! Here you can quickly access all the features of your account, manage your settings, and explore what 4SP has to offer. Use the sidebar to navigate through different sections like Proxies, Soundboard, and Games. We hope you enjoy your time here!</p>
                <p>Stay tuned for new updates and features coming soon to 4SP!</p>
            </section>

            <section id="proxy-list-section">
                <h2>Proxies</h2>
                <p>Access blocked websites and content securely with our high-performance proxies. Select from a list of available proxies to browse the internet without restrictions. Your privacy is our priority, ensuring a safe and anonymous Browse experience.</p>
                </section>

            <section id="soundboard-section">
                <h2>Soundboard</h2>
                <p>Unleash a barrage of hilarious and disruptive sounds to playfully annoy your teachers or friends. Choose from a wide array of sounds to add some mischief to your day. This section will feature controls to play various sounds.</p>
                </section>

            <section id="games-list-section">
                <h2>Games</h2>
                <p>Dive into our collection of interactive games designed to keep you entertained during boring school hours. From quick puzzles to engaging challenges, there's always something fun to play. Browse the list and pick your next game!</p>
                </section>

            <section id="settings-section">
                <h2>Settings</h2>
                <p>Manage your account settings, including your profile information, password, and preferences. Here you can update your username, change your email, or adjust notification settings to personalize your 4SP experience.</p>
                </section>
        </main>
    </div>

    <footer>
        <div class="container">
            <p>&copy; 2025 4SP. All rights reserved.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const userEmailElement = document.getElementById('userEmail');
            const userNameElement = document.getElementById('userName');
            const logoutBtn = document.getElementById('logoutBtn');
            const signOutLink = document.getElementById('signOutLink');
            const navLinks = document.querySelectorAll('.sidebar nav ul li a');
            const sections = document.querySelectorAll('.main-content section');

            // Function to show a specific section
            const showSection = (sectionId) => {
                sections.forEach(section => {
                    section.classList.remove('active-section');
                    if (section.id === sectionId) {
                        section.classList.add('active-section');
                    }
                });

                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.dataset.section + '-section' === sectionId) {
                        link.classList.add('active');
                    }
                });
            };

            // Event listeners for sidebar navigation
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const sectionId = link.dataset.section + '-section';
                    showSection(sectionId);
                });
            });

            // Handle user authentication state
            firebase.auth().onAuthStateChanged(async (user) => {
                if (user) {
                    // User is signed in.
                    userEmailElement.textContent = user.email || 'N/A'; // Display user email

                    // Fetch username from Firestore if available
                    try {
                        const userDoc = await db.collection('users').doc(user.uid).get();
                        if (userDoc.exists) {
                            const userData = userDoc.data();
                            if (userData.username) {
                                userNameElement.textContent = `Username: ${userData.username}`;
                            } else {
                                userNameElement.textContent = 'No username set';
                            }
                        } else {
                            userNameElement.textContent = 'No username set';
                        }
                    } catch (error) {
                        console.error("Error fetching user data:", error);
                        userNameElement.textContent = 'Error loading username';
                    }

                    // Show the default overview section
                    showSection('overview-section');

                } else {
                    // No user is signed in.
                    console.log('No user logged in, redirecting to login page.');
                    window.location.href = '../login.html'; // Adjusted path for redirection
                }
            });

            // Logout function
            const handleSignOut = async () => {
                try {
                    await firebase.auth().signOut();
                    console.log('User signed out.');
                    window.location.href = '../login.html'; // Adjusted path for redirection
                } catch (error) {
                    console.error('Error signing out:', error);
                    alert('Failed to sign out. Please try again.');
                }
            };

            logoutBtn.addEventListener('click', handleSignOut);
            signOutLink.addEventListener('click', handleSignOut);
        });
    </script>
</body>
</html>
